SpringBoot Shopping Entity 생성



```java
@Entity
@Builder @AllArgsConstructor @NoArgsConstructor
@Getter @Setter @EqualsAndHashCode(of = "id") 
// 비교할때 모든것을 비교하는것이 아닌 id로 비교하는것 stackoverflow 방지
public class Account {
	
	@Id @GeneratedValue
	private Integer id;
	
	private Integer age;
	
	private String email;
	
	private String password;
	
	private String address;
	
	private String phone_number;
	
	// 찜 목록 (FK) 찜목록을 옷 id로 Set 생성
	@OneToMany 
	private Set<Dress> dress_arr;
	
	@ElementCollection(fetch = FetchType.EAGER)
	@Enumerated(EnumType.STRING) 
	//enum이 기본은 index로 되어있어 나중에 enum 순서가 바뀌면 혼란이 올수 있음 String값으로 지정
	private Set<AccountRole> role;
}
```



Test를 생성하는 방법

@RunWith (SpringBoot.class) :  JUnit 프레임워크가 내장된 Runner를 실행할 때 SpringRunner.class라는 확장된 클래스를 실행 하기 위해서 사용

@SpringbootTest : 스프링 부트 어플리케이션 테스트 시 테스트에 필요한 거의 모든 의존성을 제공

@AutoConfigureMockMvc는  Mock 테스트 시 필요한 의존성 제공



#### DressControllerTest

```java
@SpringBootTest
@RunWith(SpringRunner.class)
@AutoConfigureMockMvc
public class DressCountrollerTest {

	@Autowired
	MockMvc mockMvc;
	
	@Autowired
	ObjectMapper objectMapper; //json으로 mapping해준다.
	
	@Test
	public void createDress() throws Exception {
		Dress dress = Dress.builder()
				.brand("COVERNAT")
				.article_number("C1804SL01WH")
				.sex(Sex.Man)
				.sale(39000)
				.dress_type(DressType.top)
				.discount(10)
				.explanation("Test")
				.build();
		
		mockMvc.perform(post("/api/dress")
				.contentType(MediaType.APPLICATION_JSON_UTF8) // 보내때 Json타입
				.accept(MediaTypes.HAL_JSON) //받을때 타입
				.content(objectMapper.writeValueAsString(dress)) //Json으로 mapping
				)
			.andDo(print())
			.andExpect(status().isCreated()) //기대하는것들
			.andExpect(jsonPath("id").exists())
			.andExpect(header().exists(HttpHeaders.LOCATION))
			.andExpect(header().string(HttpHeaders.CONTENT_TYPE, MediaTypes.HAL_JSON.toString()+";charset=UTF-8"))
			;
	}
```



#### DressContoller

```java
package shopping.back.hj.dress;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.hateoas.MediaTypes;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestBody;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
@RequestMapping(value = "/api/dress", produces = MediaTypes.HAL_JSON_VALUE+";charset=UTF-8")
public class DressController {
	
	@Autowired
	DressService dressService;
	
	@PostMapping
	public ResponseEntity<Dress> createDress(@RequestBody Dress dress) {
		return dressService.createDress(dress);
	}
}

```



#### DressService

```java
package shopping.back.hj.dress;

import static org.springframework.hateoas.server.mvc.WebMvcLinkBuilder.linkTo;

import java.net.URI;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.http.ResponseEntity;
import org.springframework.stereotype.Service;

@Service
public class DressService {

	@Autowired
	DressRepository dressRepository;

	public ResponseEntity<Dress> createDress(Dress dress) {
		Dress newDress = dressRepository.save(dress);

		URI createUri = linkTo(DressController.class).slash(newDress.getId()).toUri();
		return ResponseEntity.created(createUri).body(newDress);
	}

}
```

